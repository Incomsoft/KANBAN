
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если инкОбщийКлиентСервер.ЕстьСвойство(Параметры,"ДиалогиСтрока") Тогда
		
		мДиалогиКЗадаче = Параметры.ДиалогиСтрока;
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура мДиалогиКЗадачеПриНажатии(Элемент, ДанныеСобытия, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	htmlElement = НайтиСсылкуОбъекта(ДанныеСобытия.Element);
    // Анализируем если произошло нажание не ссылку
    Если htmlElement <> Неопределено Тогда
		
        Если СокрЛП(htmlElement.id) <> "" Тогда
			
			Если СтрНайти(htmlElement.id,"image") > 0 Тогда
				
				ОткрытьКартинкуНаКлиенте(htmlElement.id);
				
			КонецЕсли;
			
		КонецЕсли;	  
		
	КонецЕсли;	  			

КонецПроцедуры 

&НаКлиенте
Функция НайтиСсылкуОбъекта(Элемент)  
	
	Попытка
		
		Врем = Элемент;
	    Пока Врем <> Неопределено Цикл
	        Если НРег(Врем.tagName) = "a" Тогда
	            Возврат Врем;
	        КонецЕсли;
	        Врем = Врем.parentElement;
	    КонецЦикла;
		
	Исключение
		Возврат Неопределено;
		//ОписаниеОшибки()
	КонецПопытки;
	
КонецФункции

&НаКлиенте
Процедура ОткрытьКартинкуНаКлиенте(СсылкаСтрока)
	
	ХТМЛКодКартинки = ПолучитьХТМЛКодКартинкиНаСервере(СсылкаСтрока);
	
	Если ХТМЛКодКартинки= "" Тогда
		Возврат;
	КонецЕсли;
	
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("ДиалогиСтрока",ХТМЛКодКартинки);
	ОткрытьФорму("Задача.инкЗадачаПользователя.Форма.ФормаДиалогиКЗадаче",ПараметрыФормы,ЭтотОбъект,Новый УникальныйИдентификатор,,,,РежимОткрытияОкнаФормы.БлокироватьВесьИнтерфейс);
	
КонецПроцедуры                                                       

&НаСервере
Функция ПолучитьХТМЛКодКартинкиНаСервере(СсылкаСтрока)
	
	ЗадачаОбъект = РеквизитФормыВЗначение("Объект");
	
	Возврат ЗадачаОбъект.ПолучитьХТМЛКодКартинки(СсылкаСтрока);
	
КонецФункции
